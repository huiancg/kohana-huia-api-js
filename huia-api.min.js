"use strict";var Card=function(a){return this.options=_.extend({},Card.defaults,a),this.options.callback&&this.send(this.options.callback),this};Card.defaults={url:base_url+"huia/card",data:{},callback:null},Card.factory=function(a){return new Card(a)},Card.prototype.send=function(a){var b=$.post(this.options.url,this.options.data,"json");a&&b.success(function(b){return b?a(b):void a(!1)}).error(function(b){a(!1,b.statusText)})};var Email=function(a){return this.options=_.extend({},Email.defaults,a),this.options.callback&&this.send(this.options.callback),this};Email.defaults={url:base_url+"huia/email",data:{view:"view",subject:"TÃ­tulo"},callback:null},Email.factory=function(a){return new Email(a)},Email.prototype.send=function(a){var b=$.post(this.options.url,this.options.data);a&&b.success(function(b){return b&&JSON.parse(b).success?a(!0):void a(!1,"cant send")}).error(function(b){a(!1,b.statusText)})};var Model=function(){};Model.options={url:base_url+"api/"},Model.factory=function(a,b,c){var d=new Model;return d.options=_.extend({},Model.options),d._populate(a,b,c),d._reset(),d},Model.prototype.save=function(a,b){return this._first=a.constructor===Object,this.execute(b,"POST",a)},Model.prototype.find=function(a){return this._first=!0,this.limit(1).execute(a)},Model.prototype.find_all=function(a){return this.execute(a)},Model.prototype.count_all=function(a){return this._count_all=!0,this.execute(a)},Model.prototype.execute=function(a,b,c){var d=this;b||(b="GET");var e={_method:b,_query:d._query_builder()};return c&&(c.constructor===Function&&c.attributes&&(c=c.attributes),e=$.extend(e,c)),d._count_all&&(e._count_all=!0),d._collection.fetch({data:e,type:"POST"}).success(function(b){if(b&&b.errors)a(null,b.errors);else if(d._count_all)a(b);else{var c=d._collection.models;d._first&&(c=c[0]?c[0]:null),a(c)}d._reset()}).error(function(b,c){a(null,[{internal:b.statusText}]),d._reset()}),d},Model.prototype._reset=function(){this._query=[],this._count_all=!1,this._offset=null,this._limit=0,this._first=!1},Model.prototype._query_builder=function(){var a=this._query;return this._offset&&a.push(["offset",this._offset]),this._limit&&a.push(["limit",this._limit]),a},Model.prototype._populate=function(a,b,c){var d=this,e=(Backbone.Model.extend({}),Backbone.Collection.extend({url:function(){return d.options.url+a}}));d._collection=new e,b&&d.where("id","=",b).find(c)},Model.prototype.where=function(a,b,c){return this._query.push(["where",a,b,c]),this},Model.prototype.or=function(a,b,c){return this._query.push(["or",a,b,c]),this},Model.prototype.where_open=function(){return this._query.push(["where_open"]),this},Model.prototype.where_close=function(){return this._query.push(["where_close"]),this},Model.prototype.limit=function(a){return this._limit=a,this},Model.prototype.offset=function(a){return this._offset=a,this},Model.prototype.order_by=function(a,b){return b=b?b:"ASC",this._query.push(["order_by",a,b]),this},Model.prototype.group_by=function(a){return this._query.push(["group_by",a]),this},Model.prototype.sum=function(a,b){return this._query.push(["sum",a,b?b:null]),this};